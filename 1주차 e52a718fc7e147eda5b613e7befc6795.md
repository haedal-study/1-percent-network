# 1주차

# 1주차 내용

# Chapter 1

- story01 HTTP 리퀘스트 메시지 작성
- story02 웹 서버의 IP 주소를 DNS서버에 조회

# 컴퓨터 네트워크 스터디 진행 방향

네트워크는 개발/전산직이 일을할때 알아야 하는 필수 개념이다. 특히 컴퓨터공학 주요과목(데이터베이스,자료구조,운영체제,네트워크)는 유기적인 흐름이 상당히 중요하므로 기존 알던 지식에서 연결고리를 채워나가는 식으로 학습을 진행하려 한다.

# story1 HTTP 리퀘스트 메시지 작성

## URL이란?

[http://로](http://xn--2o2b/) 시작되는 것이라고만 알아두면 될 것 같지만 사실은 http:뿐만 아니라 ftp:로 시작하는 것, file:로 시작하는 것, mailto: 로 시작하는 것 등 여러 가지가 있다.

ftp: 파일을 다운로드 업로드 하는 클라이언트 기능.

공통적인 부분으로는 앞에 엑세스 하는 방법을 나타낸다는 점.

![Untitled](1%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20e52a718fc7e147eda5b613e7befc6795/Untitled.png)

그림1-1 각종  URL의 형식

## URL의 요소 및 해독

![Untitled](1%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20e52a718fc7e147eda5b613e7befc6795/Untitled%201.png)

![Untitled](1%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20e52a718fc7e147eda5b613e7befc6795/Untitled%202.png)

웹브라우저가 URL을 해독하는 흐름

추가로 여기서

http://koreatech.in/

 처럼 끝이 /로 끝난 것은koreatech.in/의 다음에 써야할 파일명을 쓰지않고 생략하겠다는 의미이다.

이럴 경우는 생략할때를 대비하여 서버측에 미리 설정해 둔다.(ex-index.html)

http://koreatech.in/admin

또한 만약 끝에 “/” 가 없을 경우(참고로 규칙을 정확히 이해못한 경우) admin이 파일이라면 파일으로, 디렉토리라면 디렉토리명으로 본다.

 

## HTTP의 기본 개념

### 프로토콜이란?

[Protocol](https://www.notion.so/Protocol-b9cb2dbb0f9742e09912f6509032521d?pvs=21) 

### HTTP는

리퀘스트 메시지, 리스폰스 메시지로 나눌 수 있다.

### 1. 리퀘스트 메시지

클라이언트에게 **(1)무엇을 /(2)어떻게 해서** 하겠다는 의미 

![Untitled](1%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20e52a718fc7e147eda5b613e7befc6795/Untitled%203.png)

 HTTP의 기본 개념도

(1) 무엇을은 URI 이다. 

URI는 다양한 엑세스 대상이다.(ex-xxxx.html, yyyy.cgi)

(2) 어떻게 해서는 메서드 이다.

![Untitled](1%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20e52a718fc7e147eda5b613e7befc6795/Untitled%204.png)

HTTP의 주요 메서드 버전

### HTTP1.0 /1.1의 차이

[Http pipelining](https://www.notion.so/Http-pipelining-878dd3b913fa43e79c602962469e580e?pvs=21) 

예를 들어 회원 조회, 등록, 수정, 삭제 4가지의 구조가 있다고 가정하자.

모두

/members/{id}인데 구분하는 방법은 무엇일까?

→메서드 종류를 구분해주는것

위의 그림을 통해서도  메서드 종류를 알 수 있다.(부연설명)

- GET
    - 리소스 조회
    - 서버에서 전달하고 싶은 데이터는 query를 통해 전달
    - 메시지 바디를 사용해서 데이터를 전달할 수 있지만 지원하지 않는 곳이 많아서 권장하지는 않음
- POST
    - 요청 데이터 처리
    - 메시지 바디를 통해 서버로 요청 데이터 전달
    - 서브는 요청 데이터를 처리
    - 매시지 바디를 통해 들어온 데이터를 처리하는 모든 기능을 수행
    - 주로 전달된 데이터로 신규 리소스 등록, 프로세스 처리에 사용
- PUT
    - 리소스를 대체
        - 리소스가 있으면 대체
        - 리소스가 없으면 생성
        - **덮어쓴다(PUT과의 차이)**
    - 클라이언트가 **리소스의 위치를 알고** 식별(POST와의 차이) ex) POST는 /members, PUT은 /members/100
- PATCH
    - 리소스 부분 변경
- DELETE
    - 리소스 제거
- OPTIONS
    - 주로 CORS에서 사용

### 2. 리스폰스  메시지

웹서버가 속에 쓰여져있는 내용을 해독한다.

URI와 메시지를 조사하여 ‘무엇을’ , ‘어떻게 하는지’ 판단, 동작후 결과 데이터를 응답 메시지에 저장한다.

ex) 404 Not Found

- 1XX (Informational)
    - 거의 사용되지 않음
- 2XX (Successful)
    - 클라이언트의 요청을 성공적으로 처리
        - 200 OK
            - 요청 성공
        - 201 Created
            - 요청 성공해서 새로운 리소스가 생성됨
        - 202 Accepted
            - 요청이 접수되었으나 처리가 완료되지 않았음
        - 204 No Content
            - 서버가 요청을 성공적으로 수행했지만, 응답 페이로드 본문에 보낼 데이터가 없음.
            - ex)save버튼의 결과로 아무 내용이 없어도 된다.
- 3XX(Redirection)
    - 웹브라우더는 3xx응답의 결과에 Location 헤더가 있으면, Location위치로 자동이동
        - 300 Multiple choices
        - 301 Moved Permanently
        - 302 Found
        - 303 See Other
        - 304 Not Modified
        - 307 Temporary Redirect
        - 308 Permanent Redirect
- 4XX(Client  Error)
    - 클라이언트의 요청에 잘못된 문법등으로 서버가 요청을 수행할 수 없음
    - 오류의 원인이 클라이언트에 있음
    - 클라이언트가 이미 잘못된 요청 데이터를 보내고 있기 때문에 똑같은 재시도가 실패함
        - 400 Bad Request (백엔드 개발자가 제대로 처리를 해야 한다)
            - 요청구문 메시지 오류
        - 401 Unauthorized
            - 인증되지 않음
        - 403 Forbidden
            - 인증 자격 증명은 있지만 접근권한이 불충분한 경우
        - 404 NotFound
            - 요청 리소스가 서버에 없음
- 5XX(Server Error)
    - 서버 내부 문제로 오류 발생
    - 서버에 문제가 있기 때문에 재시도 하면 성공할수도 있음(복구될경우)
    - **서버가 터진게 아닌이상 500메서드 사용을 하면 안됨(심각한 문제에만 사용)**
        - 500 Internal Server Error
            - 서버 내부 문제로 오류발생
        - 503 Service Unavailable
            - 서버가 일시적인 과부하 또는 예정된 작업으로 잠시 요청을 처리할 수 없음
            - Retry-After헤더 필드로 얼마뒤에 복구되는지 보낼 수 도 있

## 리퀘스트 메시지 와 리스폰스 메시지의 구조

![Untitled](1%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20e52a718fc7e147eda5b613e7befc6795/Untitled%205.png)

HTTP메시지의 포맷

# story2 웹 서버의 IP 주소를 DNS서버에 조회

## IP주소의 기본

HTTP의 메시지를 만들면 다음에는 이것을 OS에 의뢰하여 엑세스 대상의 웹 서버에게 송신한다. 

(이유는 브라우저는 HTTP메시지를 만드는 것은 가능하나, 메시지를 네트워크에 송출하는 기능은 없기 때문이다.)

이때 URL 안에 쓰여 있는 서버의 도메인명에서 IP주소를 조사해야 한다.

OS에 송신을 의뢰 할때는 도메인명이 아니라 IP주소로 메시지를 받을 상대를 지정해야 하기 때문이다. 그러므로 HTTP메시지를 만드는 동작의 다음은 도메인명에서 IP주소를 조사하는 동작이 되는데 이것을 설명하기 전에 IP주소레 대해 간단히 정리하자.

![Untitled](1%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20e52a718fc7e147eda5b613e7befc6795/Untitled%206.png)

위의 그림을 통해 자세한 구조 파악 가능하다.

간단히 설명하자면 엑세스 대상의 서버까지 메시지를 운반할때는 IP주소에 따라 엑세스 대상이 어디에 있는지 파악하고 운반한다. 송신측이 메시지를 보내면 서브넷 안에 있는 허브가 운반하고, 송신측에서 가장 가까운 라우터까지 도착한다. 그리고 라우터가 메시지를 보낸 상대를 확인하여 다음 라우터를 판단하고 거기에 보내도록 지시하여 송신 동작을 실행 한 후 다시 서브넷의 허브가 라우터까지 메시지를 보낸다.

![Untitled](1%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20e52a718fc7e147eda5b613e7befc6795/Untitled%207.png)

실제 IP주소는 32비트의 디지털 데이터로 , 이것을(a)와 같이 8바이트씩 점으로 구분하여 10진수로 표기한다.

하지만!!!

이것만으로는 어느부분이 네트워크 번호인지, 호스트번호인지 알 수 없다.

따라서 이것을 구분하기 위해 필요에 따라 “넷마스크”를 통해 구분을 짓는다.

위 그림의 (b)와 (c)처럼 구분을 할 수 있다.

또한 호스트 번호 부분의 비트 가뵤이 모두 0 또는1인 경우는 특별하다.

0인 경우→ 서브넷

1인 경우→브로드캐스트

## 도메인 명과 IP주소를 구분하여 사용하는 이유

URL안에 서버명이 아니라 IP주소를 사용해도 문제는 따로 없다.

다만 서버명보다 IP주소가 기억하기 어렵기 때문에 서버이름을 통해 작성하는 것이 더 좋다.

하지만!!!

실행효율 관점에서 IP주소를 아예 사용하지 않고 서버명만 사용할 경우 데이터를 운반할때

IP주소는 32비트(4바이트)에 해당하는 갯수밖에 없지만 도메인명은 수십~255바이트까지의 문자를 취급해야 한다.

그러면 라우터가 부하되어 데이터를 운반하는 동작에 더 많은 시간이 걸리면서 네트워크의 속도가 느려진다.

(고성능 라우터를 사용한다 해도 한계가 존재한다)

따라서 사용자는 도메인명 / 라우터는 IP주소를 사용하는 것이 효과적, 이에 활용되는 원리가 DNS이다.

## Socket 라이브러리가 IP주소를 찾는 기능을 제공

IP주소를 얻는 방법은 가장 가까운 DNS서버에 ‘https://koreatech.in’이라는 서버의 IP를 알려달라고 요청을 하는 것이다.

DNS서버에서 조회한다는 것은 DNS서버에 조회 메시지를 보내고 거기에서 반송되는 응답메시지를 받는 것이다. 이것은 DNS서버에 대해 클라언트로 동작한다고 말할 수 있다.

DNS클라이언트에 해당하는 것을 DNS리졸버(reslover) 라고 부른다.

DNS의 원리를 사용하여 IP주소를 조사하는 것을 네임 리졸루션(name resolution)이라고 한다.

리졸버는 Socket라이브러리에 들어있는 부품화한 프로그램이다.

Socket프로그래밍 예시: https://github.com/johnny19991006/SocketProgramming

## 리졸버를 이용하여 DNS서버 조회

![Untitled](1%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20e52a718fc7e147eda5b613e7befc6795/Untitled%208.png)

리졸버를 호출하는 방법

이렇게 해서 리졸버를 호출하면 리졸버가 DNS서버에 조회메시지를 보내고 DNS서버에서 응답메시지가 돌아온다. 이 응답 메시지속에 IP주소가 포함되어 있으므로 리졸버는 이것을 추출하여 브라우저에서 지정한 메모리 영역에 써 넣는다. 위의 코드가 실행되면 IP주소 조회동작은 끝나고 브라우저가 웹 서버에 메시지를 보낼때는 이 메모리 영역에서 IP주소를 추출하여 HTTP의 리퀘스트 메시지와 함께 OS에 건네주어 송신을 의뢰한다.

## 리졸버 내부의 작동

![Untitled](1%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20e52a718fc7e147eda5b613e7befc6795/Untitled%209.png)

그림을 통한 설명

(1)어플리케이션의 동작이 일시적으로 정지

(2)Socket라이브러리의 내용에 있는 리졸버가 옴직이기 시작하여 어플리케이션에서 의뢰받은 작업을 실행

(3)리졸버에게 제어가 넘어가고, DNS서버에 문의하기 위한 메시지를 만든다.

여기서 리졸버가 메시지 송신을 스스로 진행하는 것이 아니라 OS내부에 포함된 프로토콜 스택을 호출하여 실행을 의뢰하는 것이다.

(리졸버도 브라우저와 마찬가지로 네트워크에 대해 데이터를 송*수신하는 기능이 없다)

(4),(5)리졸버가 프로토콜 스택을 호출하면 메시지를 보내는 동작을 실행하여 LAN어댑터를 통해 메시지가 DNS서버를 향해 송신된다.

(중간)조회메시지가 DNS서버에 도착하면 DNS서버는 메시지에 쓰여 있는 조회내용을 조사하여 답을 찾는다.

(6)엑세스 대상의 웹서버가 DNS서버에 등록되어 잇으면 답이 발견되므로 답을 응답메시지에 써서 클라이언트에게 반송한다.

(7),(8)리졸버가 내용을 해독한 후 여기에서 IP주소를 추출하여 애플리케이션에 IP주소를 건네준다.

(9) 실제로는 리졸버를 호출할때 지정한 메모리 영역에 IP주소를 저장한다.

DNS서버에 메시지를 송신할떄도 DNS서버의 IP주소가 필요한데 컴퓨터에 미리 설정되어 있다.

교재:

성공과 실패를 결정하는 1%의 네트워크 원리 [https://www.yes24.com/Product/Goods/90640081](https://www.yes24.com/Product/Goods/90640081)

출처:

컴퓨터 네트워크 하향식접근 [https://www.yes24.com/Product/Goods/45543957](https://www.yes24.com/Product/Goods/45543957)

모든개발자를 위한 HTTP 웹 기본지식