# Chapter 7 : 액세스 회선을 통해 인터넷의 내부로! - 액세스 회선과 프로바이더의 탐험

## 4.1. ADSL 기술을 이용한 액세스 회선의 구조와 동작

### 4.1.1. 인터넷의 기본은 가정이나 회사의 LAN과 같다

#### 중계 장치 간의 거리
- LAN : 중계 장치 간의 거리는 주로 수미터에서 수백 미터 범위이다.
- 인터넷 : 인터넷 접속을 위해 가장 가까운 전화국에 도달하려면 수 킬로미터의 거리가 될 수 있다.

#### 라우터의 동작 차이
- LAN과 인터넷 모두 경로표에 등록된 정보를 기반으로 중계 대상을 판단한다.
- 하지만 경로표에 등록하는 방법이 다르다.


### 4.1.2. 사용자와 인터넷을 연결하는 액세스 회선
- 중계된 사용자의 패킷은 인터넷 접속용 라우터를 통해 인터넷으로 나간다.

#### 인터넷 접속용 라우터의 특징
- 인터넷 접속용 라우터의 패킷 송신 동작은 일반적인 이더넷과는 다르다.
- 이 라우터는 액세스 회선의 규칙을 따라 동작한다.

#### 액세스 회선(Access Circuit)의 정의 및 유형
- 액세스 회선은 네트워크에 연결하기 위한 통신 회로 또는 장비 등을 의미한다.
- 가정용 : [ADSL](http://www.ktword.co.kr/test/view/view.php?m_temp1=242), [FTTH](http://www.ktword.co.kr/test/view/view.php?nav=2&no=598&sh=FTTH), [CATV](http://www.ktword.co.kr/test/view/view.php?nav=2&no=34&sh=CATV), [전화 회선](http://www.ktword.co.kr/test/view/view.php?m_temp1=1030&id=338) 등의 기술이 주로 사용된다.
- 회사용 : 안정성과 속도를 위해 전용 회선 등의 다양한 기술을 활용할 수 있다.
- 액세스 회선의 종류는 다양하므로 대표적인 예로서 ADSL을 기준으로 한다.


### 4.1.3. ADSL 모델에서 패킷을 셀로 분할한다

#### ADSL(Asymmetric Digital Subscriber Line)
- 고속 인터넷 연결을 만드는데 사용되는 전화 회선기반의 통신 기술이다.
- 주요 특징
    - 비대칭성: 단방향 고속데이터 전송과 같은 비대칭 서비스를 제공한다.
    - 전화와 동시 사용: 데이터와 음성 신호를 다른 주파수 대역에서 전송하므로, 사용자는 인터넷을 사용하면서 동시에 전화 통화를 할 수 있다.
    - 거리 제한: 중계국(전화국)에서 사용자의 장소까지의 거리에 따라 속도가 감소할 수 있다. 일반적으로 3Km 이내 인구밀집지역에 대규모로 설치하기에 유리하다.

#### 동작 순서
- 다음의 순서는 개념적인 순서로, 실제 세부 동작방식은 ISP나 사용 기술에 따라 달라질 수 있다.

![ADSL Diagram](https://i0.wp.com/trnetwork.org/wp-content/uploads/2017/03/01_00_003_01_en_physical.layer_.example.ADSL_.jpg?resize=768%2C377&ssl=1)

1. 사용자의 장치는 데이터를 이더넷 프레임 형식으로 생성한다.
2. 이 프레임은 로컬 네트워크의 리피터 허브나 스위칭 허브를 통과한다.
3. 가입자모뎀 ([ATU-R](http://www.ktword.co.kr/test/view/view.php?nav=2&no=1670&sh=ATU-R)): 프레임을 받아 처리하고 [DSL](http://www.ktword.co.kr/test/view/view.php?nav=2&no=1102&sh=DSL) 신호로 변환한다.
4. 스플리터 : 전화(음성) 신호와 DSL 데이터 신호를 분리한다.
5. 2-wire 구리선: 변환된 DSL 신호를 중계국(전화국)으로 전송한다.
6. 스플리터 : 중계국에 도착한 DSL 신호에서 데이터와 전화(음성) 신호를 다시 분리한다.
7. [DSLAM](http://www.ktword.co.kr/test/view/view.php?m_temp1=1304&id=322)([ATU-C](http://www.ktword.co.kr/test/view/view.php?nav=2&no=1305&sh=ATU-C)) : [ATM](http://www.ktword.co.kr/test/view/view.php?nav=2&no=246&sh=Atm) 셀로 분할된 데이터를 받아 여러 사용자로부터의 DSL 연결을 집계하고, 고용량의 연결로 변환한다.
8. [NAS](http://www.ktword.co.kr/test/view/view.php?nav=2&no=5174&sh=NAS) : DSLAM에서 오는 연결을 받아 사용자 인증, 접속 기록, 대역폭 관리 등을 수행한다.
9. ISP [Backbone Network](http://www.ktword.co.kr/test/view/view.php?nav=2&no=1599&sh=Backbone+Network) : NAS로부터의 데이터 트래픽을 처리하고, 인터넷의 다른 부분과 통신한다.
10. 이후 사용자의 장치로 돌아올 때는 기본적으로 역순으로 동작한다.

#### [셀(cell)](http://www.ktword.co.kr/test/view/view.php?nav=2&no=1232&sh=%EC%85%80)
- 정의 : ATM(Asynchronous Transfer Mode) 통신에서 사용하는 기본 데이터 단위이다.
- 크기 : 셀은 고정된 크기를 가지며, 일반적으로 53 바이트로 구성된다. 
    - 이 중 5 바이트는 헤더 정보를 위한 것이고, 나머지 48 바이트는 실제 데이터를 위한 것이다.
- 용도 : ATM은 셀 기반의 스위칭 기술로, 패킷을 일정한 크기의 셀로 분할하여 효율적인 데이터 전송을 지원한다.


### 4.1.4. ADSL은 변조 방식으로 셀을 신호화한다
- ADSL에서 생성된 셀은 신호로 변환되어야 한다.
- ADSL은 복잡한 변조 방식을 사용하여 이진 데이터(0과 1)를 신호로 변환한다.
    - 이 변조 방식의 필요성은 주로 두 가지 이유에서 기인한다.
        - 디지털 데이터의 사각형 신호는 전송 중 왜곡이나 오류가 발생하기 쉽다.
        - 사각형 파형은 다양한 주파수 성분을 포함하므로 이를 효과적으로 전송하기 위해 적절한 변조가 필요하다.
- ADSL 모뎀은 데이터 비트를 정현파 신호에 대응시키는 변조 기술을 사용한다.

#### 변조 기술

![디지털 변조](https://i.namu.wiki/i/bF5qjbWJ-3C-tF3Du131xDJuZ6EdamSOPluJt6XI5Vz1cM8SR92YTxJT6uXHmJfjHex1mXJRn6sSqCffX6ebhmOMYOVkKR66pZdT7kyyw0JH5NII18tdtk2fAJbI_5l1AXpauzZiElN_lOfst-sVXQ.webp)
![QAN](https://www.semiconductorforu.com/wp-content/uploads/2022/09/qam.jpg)

- [진폭 변조(ASK)](http://www.ktword.co.kr/test/view/view.php?nav=2&no=2394&sh=ask) : 신호의 세기, 즉 진폭의 크기에 데이터 값을 대응시키는 방법.
- [주파수 이동 변조(FSK)](http://www.ktword.co.kr/test/view/view.php?nav=2&no=1388&sh=fsk) : 사용되는 주파수를 변경하여 데이터 값을 대응시키는 방법. FSK는 각각의 이진 데이터 비트(예: 0 또는 1)에 다른 주파수를 할당하여 데이터를 전송한다.
- [위상 변조(PSK)](http://www.ktword.co.kr/test/view/view.php?nav=2&no=698&sh=psk) : 신호의 [위상](http://www.ktword.co.kr/test/view/view.php?m_temp1=3760&id=134)을 변화시켜 데이터 값을 대응시키는 방법이다.
- [직교 진폭 변조(QAM)](http://www.ktword.co.kr/test/view/view.php?nav=2&no=1582&sh=qam) : ASK와 PSK를 결합한 방식으로, 두 방식의 장점을 활용하여 데이터를 전송한다.


### 4.1.5. ADSL은 파를 많이 사용하여 고속화를 실현한다

#### 주파수 대역의 활용
- 데이터를 전송하기 위해 단일 주파수만을 사용하는 것은 비효율적이다.
- 서로 다른 주파수 대역을 혼합하여 사용하면 데이터 전송 효율을 높일 수 있다.
- 주파수 필터를 사용하여 특정 주파수 대역만을 분리하거나 통과시킬 수 있다.

#### 데이터 할당과 전송 속도
- 여러 주파수 대역에 데이터를 할당함으로써 전송률을 증가시킬 수 있다.
- ADSL은 잡음이 적은 주파수 대역에 더 많은 데이터를 할당하며, 잡음이 많은 대역에는 더 적은 데이터를 할당한다.
- 전송 속도는 할당된 데이터의 총량에 의해 결정된다.
- ADSL은 다운로드와 업로드의 전송 속도가 다른 이유는 다운로드에 사용되는 주파수 대역이 더 넓고, 업로드에 사용되는 대역이 더 좁기 때문이다

#### 트레이닝(training)
- ADSL 모뎀은 연결 설정 시 회선의 품질을 평가하여 최적의 연결 설정을 결정하는 트레이닝 과정을 거친다.
- 이 과정에서 모뎀은 회선의 상태를 기반으로 가능한 최대 속도와 연결 안정성을 찾아 최적화한다.


### 4.1.6. 스플리터의 역할

#### 신호 분리
- 스플리터는 전화의 음성 신호와 ADSL 데이터 신호를 구분하는 장치이다.
- 음성 신호(대략 0~4kHz 범위)는 전화기로 전달되며, ADSL 신호(일반적으로 26kHz 이상)는 ADSL 모뎀으로 전달된다.
- 스플리터는 특정 주파수 이하의 신호와 그 이상의 신호를 각기 다른 경로로 분리한다.

#### 간섭 방지
- 스플리터가 없을 경우, 전화기와 ADSL 모뎀은 동일한 주파수 대역의 신호를 동시에 수신하게 되어 간섭이 발생할 수 있다.
- 스플리터는 이러한 간섭을 방지하여 통신 품질을 보장한다.


### 4.1.7. 전화국까지의 여정

#### 스플리터와 옥내 배선

![케이블](https://mblogthumb-phinf.pstatic.net/MjAyMDA3MzFfMTQw/MDAxNTk2MTczMzkxMDk2.yzC-Ac9thOW9uuLudB2HJPIA7p3CmFsQwTpHTllMgysg.UxdMmb5ukv5M14tPB3mp74ThCAOMrzgsur-3BE07KjMg.PNG.letsbeok/Gland_1-5.png?type=w800)

- 스플리터 앞에는 전화 케이블을 꽂은 모듈형 커넥터가 있다.
- 이곳을 통과하여 옥내 배선을 빠져나간다.
- 건물 등의 경우에는 [IDF](http://www.ktword.co.kr/test/view/view.php?nav=2&no=663&sh=idf)나 [MDF](http://www.ktword.co.kr/test/view/view.php?nav=2&no=662&sh=mdf)가 위치해 있다.
- 여기에는 외부에서 들어오는 배선과 건물 내부의 배선이 연결된다.

#### 서지 보호기(Surge Protector)
- 이 후 구간에는 [서지](http://www.ktword.co.kr/test/view/view.php?nav=2&no=1205&sh=Surge+Protector) 보호기가 위치해 있다.
- 낙뢰와 같이 외부 전화선에서 과도한 전류가 흘러들어오는 것을 방지하기 위한 장치로, 퓨즈 등의 보호 회로가 포함되어 있다.

#### 지하 케이블과 전화국

![전화국에서 가입자까지의 통신망 구성도](http://www.eom.co.kr/3.engineering/2.elec/5.communication/1.telephone/communication%20net/structure_6.gif)

- 서지 보호기를 지나면 신호는 전화 케이블로 이어진다.
- 이 케이블은 전주의 둘레에 묶인 금속 파이프 속을 통해 지하로 진행한다.
- 전화국에 가까워질수록 지하 케이블의 수는 증가하며, 이 케이블들이 모여 전화국으로 진입한다.
- 전화국 내에서, 이 케이블들은 전화국의 MDF로 연결된다.


### 4.1.8. 잡음의 영향

#### 전화 케이블의 특성
- 전화 케이블은 원래 음성 통신을 위해 설계되었다. 따라서, 높은 주파수의 ADSL 신호에 대해 최적화되어 있지 않다.
- 이런 특성 때문에 전화 케이블은 ADSL의 높은 주파수 신호 전송 시 잡음의 영향을 더욱 쉽게 받는다.

#### ADSL 신호와 주파수 대역
- ADSL은 여러 주파수 대역에서 데이터를 전송한다.
- 잡음에 의해 방해받는 주파수 대역이 늘어나면 가용할 수 있는 주파수 대역이 줄어들게 되어, 전체적인 인터넷 속도 또한 감소하게 된다.


### 4.1.9. DSLAM을 통과하여 BAS에 도달한다

#### DSLAM과 그 기능
- 전화국에 도착한 신호는 DSLAM에 도달하게 된다. 이때 DSLAM은 전기 신호를 디지털 데이터의 셀로 변환한다.
- DSLAM은 신호의 파형을 분석하여 진폭과 위상을 조사하고, 이를 바탕으로 어느 비트에 대응되는지 판단하여 데이터를 복원한다.
- 사용자 측의 ADSL 모뎀의 수신 동작과 동일한 원리로 작동한다. 그러나 전화국에서는 다수의 사용자를 처리해야 하므로, 다수의 모뎀 기능을 한데 모은 DSLAM이라는 장치를 사용한다.

#### DSLAM과 ADSL 모뎀의 차이점
- 대부분의 DSLAM은 이더넷 인터페이스 대신 ATM 인터페이스를 가지고 있다.
- 따라서, DSLAM은 패킷을 셀 형태로 분할하고, 이 셀들을 후방의 네트워크 장비와 주고받게 된다.

#### [BAS(Broadband Access Server)](https://en.wikipedia.org/wiki/Broadband_remote_access_server)와의 연결
- DSLAM에서 나온 셀은 BAS라는 패킷 중계 장치로 전송된다.
- BAS에서는 받은 셀들을 다시 패킷 형태로 복원하며, 이 과정에서 ATM 인터페이스는 필요에 따라 셀을 패킷으로 변환하는 기능을 수행한다.
- 복원된 패킷은 이후 인터넷으로 중계된다.



## 4.2. 광섬유를 이용한 액세스 회선(FTTH)

### 4.2.1. 광섬유의 기본

![광섬유](https://mblogthumb-phinf.pstatic.net/MjAxOTAyMTdfMjY2/MDAxNTUwMzY5ODMyNTcx.UAwyiUeTQvSgRjLMxkdHPAkkTuFJRK9tUl_MvsYuNvEg.FbL--FmuqOi87fd3zekhWZK1p9WJXGNHxjgSvYwaUTEg.JPEG.iotsensor/%25EA%25B4%2591%25EC%2584%25AC%25EC%259C%25A0_%25EB%2582%25B4%25EB%25B6%2580%25EA%25B5%25AC%25EC%25A1%25B0.jpg?type=w800)

#### 광섬유의 특징 및 구조
- FTTH의 핵심은 광섬유를 사용한다는 것이다.
- 광섬유는 '코어'와 '클래딩'이라는 이중 구조의 투명한 섬유로 구성되어 있다. 빛은 코어를 통해 전송되며, 클래딩은 빛이 코어 밖으로 유출되지 않게 한다.
- 이 기술의 주요 장점은 높은 데이터 전송 속도, 긴 전송 거리, 그리고 외부 전자적 간섭에 대한 높은 내성이다.

#### 디지털 데이터의 광신호 변환
- 빛의 발생하는 상태는 디지털 데이터에서의 '1'을, 빛이 없는 상태는 '0'을 나타낸다.
- 디지털 데이터를 광신호로 변환하기 위해, 데이터는 먼저 전기 신호로 변환된다. 이 전기 신호는 '1'이 높은 전압, '0'이 낮은 전압으로 표현된다.
- 이 전기 신호는 [LED](http://www.ktword.co.kr/test/view/view.php?nav=2&no=2381&sh=LED)나 [포토 다이오드](http://www.ktword.co.kr/test/view/view.php?nav=2&no=4145&sh=%ED%8F%AC%ED%86%A0%EB%8B%A4%EC%9D%B4%EC%98%A4%EB%93%9C)와 같은 광원에 전달되며, 광원은 전압에 따라 빛을 발산한다.

#### 광섬유를 통한 신호 전송 및 수신
- 이렇게 생성된 빛은 광섬유를 통과하여 수신측으로 전송된다.
- 수신측에는 포토다이오드와 같은 [수광 소자](http://www.ktword.co.kr/test/view/view.php?nav=2&no=906&sh=%EC%88%98%EA%B4%91+%EC%86%8C%EC%9E%90)가 설치되어 있다. 이 소자는 빛의 밝기에 따라 전압을 생성한다. 밝은 빛은 높은 전압의 전기 신호로, 어두운 빛은 낮은 전압의 전기 신호로 변환된다.
- 최종적으로, 이 전기 신호는 원래의 디지털 데이터로 다시 변환되어 수신된다.


### 4.2.2. 싱글모드와 멀티모드의 차이

#### 광섬유의 핵심 특성
- 광통신의 핵심은 빛을 전달하는 광섬유이다.
- 광섬유의 재질, 빛의 투과율, 굴절률, 그리고 코어의 직경 등은 빛의 전송 방법에 크게 영향을 준다.

####  코어의 굵기와 빛의 상호작용
- 중요한 것 중 하나는 코어의 굵기
- 다양한 각도의 빛이 코어에 입사하며, 이때 빛의 입사각에 따라 전반사되거나 광섬유 밖으로 나갈 수 있다.
- 빛은 파동 특성을 가지므로 각각의 파동이 서로 상호작용하며, 위상에 따라 강화되거나 상쇄될 수 있다.

#### 싱글모드와 멀티모드의 정의 및 특징

![싱글모드와 멀티모드](https://t1.daumcdn.net/cfile/tistory/225412375950C2A001?original)

- 코어의 직경에 따라 광섬유는 싱글모드와 멀티모드로 구분된다.
- 싱글모드는 코어의 직경이 작아 한 방향의 빛만을 전송한다.
- 멀티모드는 코어의 직경이 크기 때문에 여러 방향의 빛이 동시에 전송된다.

#### 각 모드의 용도와 장단점
- 멀티모드는 주로 건물 내부 연결에 적합하며, 싱글모드는 긴 거리 통신에 더 적합하다.
- FTTH와 같은 긴 거리 통신에서는 싱글모드 광섬유가 주로 사용된다.


### 4.2.3. 광섬유를 분기시켜서 비용을 절감한다
- FTTH 액세스 회선은 ADSL과는 달리 광섬유를 사용하여 사용자측의 인터넷 접속용 라우터와 인터넷측의 BAS를 접속한다.
- 이 형태는 크게 두 가지이다.

![PON, P2P](https://fibre.guide/wp-content/uploads/2017/10/ftth-pon-p2p.jpg)

#### 직접 연결 방식(Direct Connection) - Point-to-Point(P2P)
- 사용자와 가장 가까운 전화국측을 직접 연결하는 방식이다.
- 동작 순서
    1. 사용자의 장치(PC, 스마트폰)에서 인터넷 데이터 요청(웹사이트 방문)이 발생하면, 이 데이터는 먼저 사용자의 로컬 네트워크(홈 라우터)를 거쳐 미디어 컨버터로 전송된다.
    2. 사용자 측에 설치된 미디어 컨버터는 주로 전기 신호를 광신호로 변환하며, 네트워크 통신의 다양한 기능들도 수행한다.
    3. 이 광신호는 바로 BAS의 앞에 있는 집합형 미디어 컨버터에 도달하며, 그곳에서 다시 전기 신호로 변환되어 BAS의 포트로 중계된다.
        - 사용자에서 BAS로 향하는 상향 광신호와 BAS에서 사용자로 향하는 하향 광신호가 존재한다. 
        - 두 신호는 [파장 다중(WDM: Wavelength Division Multiplexing)](http://www.ktword.co.kr/test/view/view.php?nav=2&no=908&sh=WDM) 기술을 활용하여 광섬유 내에서 다른 파장을 사용하여 동시에 전송될 수 있다.

#### 분기 연결 방식(Branched Connection) - Passive Optical Network(PON)

![PON](https://2.bp.blogspot.com/-LDZCahSa-rA/Wb9vW8HMR_I/AAAAAAAABJY/14SHjN9IsBwZNk8dd0i2HT0PpgDJMqLAgCLcBGAs/s1600/11.png)

- 사용자 부근의 전주에 광스플리터라는 분기 장치를 설치하여 여러 사용자와 연결하는 방식이다.
- 여기에서는 미디어 컨버터 대신 [ONU(Optical Network Unit)](http://www.ktword.co.kr/test/view/view.php?nav=2&no=3502&sh=ONU) 라는 장치를 사용한다.
- 동작 순서
    1. 사용자의 장치에서 인터넷 데이터 요청이 발생할 때마다 해당 데이터는 ONU로 전송된다.
    2. ONU에서 발생한 광신호는 광스플리터를 통해 여러 사용자의 신호와 합쳐져서 중앙 사무소나 데이터 센터에 위치한 [OLT(Optical Line Terminal)](http://www.ktword.co.kr/test/view/view.php?nav=2&no=3502&sh=OLT)로 전송된다.
    3. OLT는 이 광신호를 집계하여 BAS로 전송한다.
    4. 복수의 사용자가 동시에 데이터를 송신할 경우, 광스플리터에서 광신호가 동시에 도달하여 **패킷 충돌** 이 발생할 수 있다.
    5. 이를 방지하기 위해, OLT와 ONU 사이의 통신은 [TDMA(Time Division Multiple Access)](http://www.ktword.co.kr/test/view/view.php?nav=2&no=348&sh=TDMA) 기술을 사용하여 각 ONU가 특정 시간 슬롯에서만 데이터를 전송하도록 조정된다.
    6. BAS에서 사용자측으로의 신호 전송 시, 모든 ONU에 도달하게 되므로, 각 ONU는 자신에게 오는 신호를 식별하여 처리한다.



## 4.3. 액세스 회선으로 이용하는 PPP와 터널링

### 4.3.1. 본인 확인과 설정정보를 통지한다

#### 본인 확인과 설정 정보
- ADSL, FTTH은 발전된 형태의 액세스 회선이다.
- 보안 이슈로 본인 확인과 설정값 통지 기능이 최근의 액세스 회선에서는 필수적으로 요구된다.
- ADSL이나 FTTH 액세스 회선은 사용자명과 패스워드 입력 없이는 인터넷 접속이 불가능하다.
- 인터넷에 접속하기 위해 PC는 글로벌 IP 주소 설정이 필요하다. 
    - 고정된 값으로 저장할 수 없기 때문에, 매 접속마다 인터넷 제공자로부터 IP 주소를 할당받아야 한다

#### BAS의 역할과 PPPoE
- BAS는 이러한 본인 확인과 설정 정보 통지의 창구 역할을 한다.
- 이를 수행하기 위해 [PPPoE](http://www.ktword.co.kr/test/view/view.php?nav=2&no=1672&sh=pppoe)라는 구조가 사용된다. PPPoE는 Ethernet 환경에서 [PPP](http://www.ktword.co.kr/test/view/view.php?nav=2&no=1074&sh=PPP) 프레임을 전송하기 위해 설계된 구조다.

#### PPP의 동작 순서
1. 프로바이더의 액세스 포인트에 연결을 수립한다.
2. 로그인 절차를 위해 사용자명과 패스워드를 입력한다.
3. RADIUS 프로토콜을 통해 본인을 인증 서버에 확인한다.
4. 사용자에게 필요한 설정 정보를 반환하고, 이를 사용자측에 전송한다.
5. 반환 받은 설정 정보를 바탕으로 사용자 PC에서 글로벌 IP 주소를 설정하고 패킷의 송수신 준비를 마친다.


### 4.3.2. 이더넷에서 PPP 메시지를 주고받는 PPPoE

#### PPP와 HDLC의 관계
- PPP 메시지를 운반할 때는, IP 패킷을 이더넷 패킷에 포함시켜 전송하는 것과 같은 메커니즘이 필요하다.
- 이를 위해, PPP는 HDLC라는 프로토콜의 프레이밍 기술을 차용한다.

#### PPPoE의 도입
- ADSL이나 FTTH는 HDLC 프레이밍을 직접적으로 사용하지 않기 때문에, 다른 형태의 프레이밍 방식이 필요하다.
- 그 결과, HDLC 대신 이더넷 프레이밍을 기반으로 한 새로운 프로토콜이 도입되었는데, 이것이 바로 PPPoE이다.


### 4.3.3. 터널링 기능에 의해 프로바이더에 패킷을 전달한다

![터널링](https://traefik.io/static/c20e9c3c32968cbadf7f0654ab7e5e36/Diagram.jpg)

#### 터널링의 개념
- BAS에는 본인 확인의 창구 역할 하는 기능과 함께 터널링이란 개념을 사용하여 패킷을 운반하는 기능도 있다. 
- 터널링은 하나의 네트워크 내에서 다른 네트워크의 통신을 중계하기 위한 기술이다. 
- 한쪽의 터널링 출입구에서 패킷을 넣으면, 그대로 반대쪽 출입구에 도달한다.
- 이 개념을 사용하여 BAS와 프로바이더의 라우터 사이에 있는 ADSL/FTTH 접속 서비스 사업자의 네트워크 안에 터널을 만든다.

#### L2 Tunneling
- 주요 방식에는 [PPTP](http://www.ktword.co.kr/test/view/view.php?nav=2&no=1589&sh=PPTP), [L2TP](http://www.ktword.co.kr/test/view/view.php?nav=2&no=2030&sh=L2TP), [MPLS](http://www.ktword.co.kr/test/view/view.php?nav=2&no=1328&sh=MPLs)가 있다.
- PPTP : Microsoft에서 개발하였으며, 터널링은 가능하지만 데이터 암호화 기능이 없다. 암호화를 추가하려면 IPSec과 함께 사용해야 한다.
- L2TP : PPTP의 기능을 개선하여 프로토콜이다. 마찬가지로 데이터 암호화 기능이 없어서 MS의 MPPE와 함께 사용해야 한다. 
    - 초기 VPN 구현에 광범위하게 사용되었으나 현재는 IPSec, SSL/TLS 등으로 대체되었다.
- MPLS : 네트워크 기반의 터널링을 구현하는 기술이다.

#### L3 Tunneling
- 주요 방식에는 [IPSec](http://www.ktword.co.kr/test/view/view.php?nav=2&no=2029&sh=IPSec)과 [GRE](http://www.ktword.co.kr/test/view/view.php?nav=2&no=1606&sh=gre)가 있다.
- IPSec: 암호화 및 터널링 모두 가능한 기술이다.
- GRE: 터널링은 가능하지만 암호화 기능이 없다. 데이터 암호화가 필요한 경우 GRE와 IPSec을 결합해야 한다.

#### L4 Tunneling
- 주요 방식에는 [SSL/TLS](http://www.ktword.co.kr/test/view/view.php?nav=2&no=1957&sh=ssl%2Ftsl), [SSH](http://www.ktword.co.kr/test/view/view.php?nav=2&no=2524&sh=ssh), [SOCKS v5](http://www.ktword.co.kr/test/view/view.php?m_temp1=6422&id=902) 등이 있다.
- 이 계층에서는 클라이언트와 서버 사이의 두 응용 프로그램 간에 세션 단위로 터널링이 설정된다. 주로, TCP(때로는 UDP)를 이용하여 보안 채널을 형성한다.
- SSL/TLS : 웹 브라우저와 서버 간의 보안된 연결을 제공하는 암호화 프로토콜이다. 
    - 주로 웹 통신에서 개인 정보나 결제 정보의 안전한 전송을 위해 사용된다.
- SSH : 네트워크 상의 다른 컴퓨터에 로그인하거나 원격에서 명령을 실행할 때 사용하는 프로토콜이다. 
    - 데이터는 암호화되어 전송되므로 중간에서의 데이터 탈취나 변조를 방지한다.
- SOCKS v5: 특정 클라이언트와 최종 목적지 사이에서 트래픽을 중계하는 역할을 하는 서버의 동작 방식을 정의한다. 
    - 이를 통해, 사용자의 실제 IP 주소를 숨기거나, 네트워크 제한을 우회하는 등의 기능을 수행할 수 있다.


### 4.3.4. 액세스 회선 전체의 동작 순서

#### 1. 인터넷 접속용 라우터의 설정
- 사용자 측에서 인터넷 접속용 라우터를 설치하며, 프로바이더로부터 받은 사용자명과 패스워드를 설정한다.
- 인터넷 접속용 라우터는 설정 후 PPPoE의 Discovery 동작을 통해 BAS를 탐색한다. 이 탐색은 ARP와 유사하게 브로드캐스트로 수행된다.

#### 2. BAS와의 인증 및 설정 정보 획득
- 사용자명과 패스워드는 BAS로 전송된다.
- 패스워드는 CHAP 또는 PAP 방식 중 선택하여 전송될 수 있다.
- 패스워드 확인 후, BAS는 TCP/IP 설정 정보를 사용자에게 반환한다. 이 설정 정보에는 IP 주소, DNS 서버의 IP 주소 및 기본 게이트웨이의 IP 주소가 포함된다.

#### 3. 패킷 중계 (라우팅)
- 클라이언트에서 발송된 패킷은 대부분 인터넷 접속용 라우터의 라우팅 테이블에 있는 목적지를 가리키지 않을 수 있다.
- 이런 경우에는 패킷 중계가 수행된다.

#### 4. 패킷의 헤더 추가 및 변환
- 송신 패킷에 헤더를 추가한다.
- MAC 헤더의 수신처 주소는 PPPoE의 Discovery에서 확인한 BAS 주소, 송신처 주소는 인터넷 접속용 라우터의 주소를 사용한다. 이더 타입에는 PPPoE 표시인 8864 값을 입력한다.
- 패킷 내용 분석 없이, 사전에 정해진 헤더 정보만 추가한다.
- 이후 패킷은 신호로 변환되어 라우터의 포트를 통해 전송된다.

#### 5. BAS에서의 패킷 처리
- 패킷이 BAS에 도착하면, PPPoE 헤더를 제거하고 PPP 헤더 이후의 부분을 추출한다.
- 그 후, 터널링 기술을 활용하여 해당 패킷을 전송한다.


### 4.3.5. IP 어드레스를 할당하지 않는 언넘버드

#### IP 주소의 불필요성
- 직접 연결된 라우터 포트 간에는 IP 주소 할당이 필요 없음.
    - 패킷은 예외 없이 반대편으로 도착하기 때문이다.
    - 따라서 중계 대상 주소의 조사나 게이트웨이 주소의 기록이 불필요하다.
- 과거에는 모든 인터페이스에 IP 주소 할당이 규칙이었으나, 현재는 1 대 1로 접속된 포트에 할당하지 않아도 된다.

#### [IP Unnumbered](http://www.ktword.co.kr/test/view/view.php?nav=2&no=2541&sh=unnumber)
- IP 주소를 할당하지 않는 설정 방식이다.
- 이 방식으로 IP 주소 자원을 효율적으로 사용 가능하다.
    - 주소 절약 : 1 대 1로 직접 연결된 인터페이스에서 IP 주소를 할당하지 않으므로 주소 자원을 절약할 수 있다.
    - 설정 간소화 : IP 주소 할당이 필요 없어, 네트워크 구성이 간소화되며 관리 부담이 줄어든다.
    - 주소 재할당 및 충돌 방지 : IP 주소를 할당하지 않기 때문에 주소 재할당이나 IP 주소 충돌 문제를 방지하거나 최소화 할 수 있다.
    

### 4.3.6. 인터넷 접속용 라우터에서 프라이비트 주소를 글로벌 주소로 변환한다
- 인터넷 접속용 라우터는 패킷 중계 시 NAT 기술을 사용하여 주소 변환을 수행한다.
- 이 때, BAS를 통해 라우터에 글로벌 주소가 할당되므로, PC에 직접적으로 글로벌 주소를 할당할 수 없다.
- 결과적으로, PC에는 private 주소가 할당되며, PC가 보낸 패킷은 인터넷 접속용 라우터에서 NAT를 통해 주소 변환한 후 인터넷에 중계된다.

#### 발생할 수 있는 문제와 해결 방안
- 애플리케이션 내에서 자신의 IP 주소 정보를 상대방에게 전달해야 하는 경우, NAT의 변환 과정에서 원래의 IP 정보가 변경되기 때문에 문제가 발생할 수 있다.
- 해결을 위해, 라우터의 특정 NAT 기능을 활용하거나 PC를 NAT 없이 인터넷에 직접 연결할 수 있다.
    - 직접 연결하는 경우, 외부로부터의 접근이 쉬워져 공격에 노출될 수 있으므로, 방화벽 같은 보안 대책이 필요하다.


### 4.3.7. PPPoE 이외의 방식
- 현실의 액세스 회선에는 PPPoE 이외의 방법도 존재한다. 그 중 하나가 PPPoA라는 방식으로, 주로 ADSL 액세스 회선에서 사용된다.

#### [PPPoA(Point-to-Point Protocol over ATM)](http://www.ktword.co.kr/test/view/view.php?nav=2&no=2261&sh=Pppoa)
- PPPoA는 PPP 프레임을 ATM 셀로 전송하는 방식이다.
- 이 방식의 주요 특징은 이더넷의 MAC 헤더를 붙이지 않기 때문에, PPP 프레임을 이더넷에 바로 전송할 수 없다는 것이다.
- 해당 프로토콜을 사용할 경우 PPP 메시지를 주고받는 기기, 예를 들면 PC나 라우터,를 ADSL 모뎀과 일체화하지 않으면 동작하지 않는다.
- 이러한 일체화를 구현하는 방법에는 두 가지가 있다.
    - PC의 USB 인터페이스에 모뎀을 연결하는 방법
    - 모뎀과 라우터를 결합한 라우터 일체형 모뎀 사용 방법
- PPPoA는 이더넷 패킷을 사용하지 않기 때문에 MTU가 짧아지지 않아 데이터 효율성이 떨어지지 않는다.


---

# 참고자료
- [Access Circuit definition](https://www.lawinsider.com/dictionary/access-circuit)
- [What is ADSL And How Does it Work?](https://www.bytesdigital.co.uk/blog/what-is-adsl-and-how-does-it-work)
- [Physical Layer – Two Example from Daily Life](https://trnetwork.org/en/physical-layer-two-example/)
- [Internet Access Guide : ADSL](https://www.conniq.com/InternetAccess_ADSL.htm)
- [What is Quadrature Amplitude Modulation (QAM)](https://www.semiconductorforu.com/what-is-quadrature-amplitude-modulation-qam/)
- [How does upload affect download speed in adsl?](https://www.quora.com/How-does-upload-affect-download-speed-in-adsl)
- [Upload vs. download speed: What’s the difference?](https://www.allconnect.com/blog/difference-between-download-upload-internet-speeds)
- [ADSL Modems => Training the Modem](https://www.tech-faq.com/adsl-modem.html)
- [ADSL2+ Woes: What’s in a Training Signal?](https://goughlui.com/2014/05/19/adsl2-woes-whats-in-a-training-signal/)
- [케이블그랜드(Cable Gland)와 국가별 배선 규격](https://m.blog.naver.com/letsbeok/222047267719)
- [전화망의 구조](http://www.eom.co.kr/3.engineering/2.elec/5.communication/1.telephone/structure.htm)
- [광섬유 센서의 원리](https://m.blog.naver.com/iotsensor/221467798725)
- [FTTH – FIBER TO THE HOME - FIBRE JUSQU'À L'ABONNÉ](https://fibre.guide/deploiement/technologies/ftth)
- [Let’s get to the point: your FTTH architecture is a strategic choice](https://www.blog.adtran.com/en/lets-get-to-the-point-your-ftth-architecture-is-a-strategic-choice)
- [Passive Optical Network Tutorial](https://community.fs.com/blog/passive-optical-network-tutorial.html)
- [터널링이란? | 네트워킹에서의 터널링](https://www.cloudflare.com/ko-kr/learning/network-layer/what-is-tunneling/)
- [Network Tunneling:What Is It and How Is It Used?](https://traefik.io/glossary/network-tunneling/)
- [IP Unnumbered Explained](https://networklessons.com/cisco/ccie-routing-switching/ip-unnumbered-explained)
- [IP unnumbered](https://www.tek-tips.com/viewthread.cfm?qid=882070)
- [CCNP 1: Advanced IP Addressing Management - IP Unnumbered](https://www.ciscopress.com/articles/article.asp?p=330807&seqNum=7)
- [PPPoA 기본 아키텍처](https://www.cisco.com/c/ko_kr/support/docs/long-reach-ethernet-lre-digital-subscriber-line-xdsl/pppoe-pppoa-ppp-over-ethernet-ppp-over-atm/12914-pppoa-arch.html)